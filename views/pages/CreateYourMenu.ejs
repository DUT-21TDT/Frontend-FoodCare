<div class="container" id="createMenu">
  <div class="CYM_header">
    <a href="/user/MyMenu" class="">
      <i class="fa-solid fa-circle-arrow-left CYM_header__icon"></i>
    </a>
    <h2 class="CYM_header__title">Create Your Menu</h2>
  </div>
  <div class="CYM_body">
    <div class="CYM_body__left">
      <div class="CYM_body__left-top">
        <input type="text" placeholder="Nhập tên thực đơn của bạn" id="CYM_body__left-top--nameMenu">
        <h3 class="CYM_body__left--title">Nutritions</h3>
        <div class="CYM_body__left-nutriinfor">
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Energy</div>
            <span class="nutriinfor--item__text">10 Calo</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Water</div>
            <span class="nutriinfor--item__text">11 ml</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Carbs</div>
            <span class="nutriinfor--item__text">12 gram</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Protein</div>
            <span class="nutriinfor--item__text">13 gram</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Lipid</div>
            <span class="nutriinfor--item__text">14 gram</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Vitamins</div>
            <span class="nutriinfor--item__text">A B C D</span>
          </div>
          <div class="CYM_body__left-nutriinfor--item">
            <div class="nutriinfor--item__circle">Minerals</div>
            <span class="nutriinfor--item__text">Ca K Mg Zn</span>
          </div>
        </div>
        <div class="CYM_body__left-bottom">
          <button class="CYM_body__left-bottom--button btnBreakfast" style = "background-color: #d6e68a;">
            Breakfast
          </button>
          <button class="CYM_body__left-bottom--button btnLunch">
            Lunch
          </button>
          <button class="CYM_body__left-bottom--button btnDinner">
            Dinner
          </button>
          <div>
            <table class="CYM_body__left-bottom--table">
              <thead>
                <tr>
                  <th>Name of food</th>
                  <th>Count</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="Breakfast">

              </tbody>
              <tbody id="Lunch" style="display:none">

              </tbody>
              <tbody id="Dinner" style="display:none">

              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
    <div class="CYM_body__right">
      <div class="CYM_body__right-top">
        <!-- thanh search -->
        <div class="divSearch">

          <i class="fa-solid fa-magnifying-glass divSearch__icon"></i>
          <input type="text" placeholder="Tìm kiếm thực phẩm" class="divSearch__input">
          <button class="divSearch__btn">Search</button>
        </div>
      </div>
      <div class="CYM_body__right-bottom">
        <ul>
          <li>
            <div class="CYM_body__right-bottom--img">
              <img src="../assets/images/search_img/search-1.jpg" alt="">

              <a href=""><i class="fa-solid fa-magnifying-glass CYM_body__right-bottom--icon Detail"></i></a>
              <a href=""><i class="fa-solid fa-circle-plus CYM_body__right-bottom--icon Add"></i></a>

            </div>
            <span class="NameOfFood">Pizza</span>


          </li>
          <li>
            <div class="CYM_body__right-bottom--img">
              <img src="../assets/images/search_img/search-2.jpg" alt="">
              <a href=""><i class="fa-solid fa-magnifying-glass CYM_body__right-bottom--icon Detail"></i></a>
              <a href=""><i class="fa-solid fa-circle-plus CYM_body__right-bottom--icon Add"></i></a>

            </div>
            <span class="NameOfFood">Phở</span>
          </li>
          <li>
            <div class="CYM_body__right-bottom--img">
              <img src="../assets/images/search_img/search-3.jpg" alt="">
              <a href=""><i class="fa-solid fa-magnifying-glass CYM_body__right-bottom--icon Detail"></i></a>
              <a href=""><i class="fa-solid fa-circle-plus CYM_body__right-bottom--icon Add"></i></a>

            </div>
            <span class="NameOfFood">Bánh Kẹp</span>
          </li>
          <li>
            <div class="CYM_body__right-bottom--img">
              <img src="../assets/images/search_img/search-4.jpg" alt="">
              <a href=""><i class="fa-solid fa-magnifying-glass CYM_body__right-bottom--icon Detail"></i></a>
              <a href=""><i class="fa-solid fa-circle-plus CYM_body__right-bottom--icon Add"></i></a>

            </div>
            <span class="NameOfFood">Bún Chả</span>
          </li>
        </ul>
        <a href="" class="">
          <i class="fa-solid fa-circle-arrow-right CYM_body__right-bottom__icon"></i>
        </a>
        <!-- 4 picture -->
      </div>
    </div>
  </div>
  <div class="CYM_footer">
    <!-- <button class="CYM_footer__btn btnDelete" onclick="window.location.href='/begin/myMenu'">
      Cancel
    </button> -->
    <button class="CYM_footer__btn bntSave">
      Save
    </button>
  </div>
</div>


<link rel="stylesheet" href="../assets/css/Create Your Menu.css">

<script>

  var checkButton = "Breakfast";
  var createElementFood = function (text) {

    var ElementFood = document.createElement("tr");
    ElementFood.innerHTML = `
          <td>${text}</td>
          <td>1</td>
          <td><a href="#" onclick="decreaseCount(this)"><i class="fa-solid fa-circle-minus table-icon"></i></a></td>`;


    return ElementFood;

  }
  var CheckCountFood = function(text)
  {
        var foodCount = {};
        $('.CYM_body__left-bottom--table tbody tr').each(function() {
          var foodName = $(this).find('td:first-child').text().trim();
          if (foodCount.hasOwnProperty(foodName)) {
            foodCount[foodName]++;
          } else {
            foodCount[foodName] = 2;
          }
      });

      return foodCount[text] || 1;
  }

  function checkFoodExistence(checkButton, nameFood) {
  var txt = checkButton;
  var foodTable = document.getElementById(txt);
  if (foodTable) {
    var rows = foodTable.getElementsByTagName("tr");
    for (var i = 0; i < rows.length; i++) {
      var foodName = rows[i].getElementsByTagName("td")[0].textContent;
      if (foodName === nameFood) {
        if (checkButton) {
          var count = rows[i].getElementsByTagName("td")[1].textContent;
        }
        return true; 
      }
    }
  }

  return false; 
}
function addFood(checkButton,nameFood) {
  var txt = checkButton;
  var foodTable = document.getElementById(txt);
  if (foodTable) {
    var rows = foodTable.getElementsByTagName("tr");
    for (var i = 0; i < rows.length; i++) {
      var foodName = rows[i].getElementsByTagName("td")[0].textContent;
      if (foodName === nameFood) {
        var countCell = rows[i].getElementsByTagName("td")[1];
        var count = parseInt(countCell.textContent);
        countCell.textContent = count + 1;

        return; 
      }
    }
  }
}
function decreaseCount(link) {
  var row = link.parentNode.parentNode; // Lấy thẻ <tr> chứa thẻ <a>

  var countCell = row.getElementsByTagName("td")[1];
  var count = parseInt(countCell.textContent);

  if (count > 0) {
    countCell.textContent = count - 1;

    if (count - 1 === 0) {
      var tbody = row.parentNode;
      tbody.removeChild(row);
    }
  }
}


  $(document).ready(function () {
    
    $(".btnBreakfast").click(function (event) {
      checkButton = "Breakfast";
      $("#Lunch").css("display", "none");
      $("#Dinner").css("display", "none");
      $("#Breakfast").fadeIn("slow");
      $("#Breakfast").css("display", "table-row-group");
      $(this).css("background-color", "#d6e68a");
      $(".btnLunch").css("background-color", "");
      $(".btnDinner").css("background-color", "");

    })
    $(".btnLunch").click(function (event) {
      checkButton = "Lunch";
      $("#Breakfast").css("display", "none");
      $("#Dinner").css("display", "none");
      $("#Lunch").fadeIn("slow");
      $("#Lunch").css("display", "table-row-group");
      $(this).css("background-color", "#d6e68a");
      $(".btnBreakfast").css("background-color", "");
      $(".btnDinner").css("background-color", "");
    })
    $(".btnDinner").click(function (event) {
      checkButton = "Dinner";
      $("#Breakfast").css("display", "none");
      $("#Lunch").css("display", "none");
      $("#Dinner").fadeIn("slow");
      $("#Dinner").css("display", "table-row-group");
      $(this).css("background-color", "#d6e68a");
      $(".btnBreakfast").css("background-color", "");
      $(".btnLunch").css("background-color", "");
    })

    // $(".table-icon").click(function(event){
    //   event.preventDefault();
    //   let elementTBody = $(this).closest("tr");
    //   elementTBody.remove();
    // })
    $("tr a").click(function (event) {
      event.preventDefault();
      let elementTBody = $(this).closest("tr");
      elementTBody.remove();
    })

    $(".CYM_body__right-bottom--img").hover(
      function () {
        $(this).find('img').css("opacity", "0.3");
        $(this).find('i').fadeIn(500);

      },
      function () {
        $(this).find('img').css("opacity", "1");
        $(this).find('i').fadeOut(500);

      }
    );
    $(".CYM_body__right-bottom--icon.Add").click(function (event) {
      event.preventDefault();
      var text = $(this).closest('li').find('.NameOfFood').text();
      var ElementFood = createElementFood(text);
      if (checkButton == "Breakfast") {
        if(!checkFoodExistence(checkButton,text))
        {
          $("#Breakfast").append(ElementFood);
        }
        else {
          addFood(checkButton,text);
        }
        
      }
      else if (checkButton == "Lunch") {
        if(!checkFoodExistence(checkButton,text))
        {
          $("#Lunch").append(ElementFood);
        }
        else {
          addFood(checkButton,text);
        }
        
      }
      else {
        if(!checkFoodExistence(checkButton,text))
        {
          $("#Dinner").append(ElementFood);
        }
        else {
          addFood(checkButton,text);
        }
       
      }
    })
    $(document).on("click", "tr a", function (event) {
      event.preventDefault(); // ngăn chặn trình duyệt chuyển hướng sang một trang khác
      // code xử lý sự kiện click
      event.preventDefault();
      let elementTBody = $(this).closest("tr");
      // decreaseCount(elementTBody);
      // elementTBody.remove();

    });



  })


</script>